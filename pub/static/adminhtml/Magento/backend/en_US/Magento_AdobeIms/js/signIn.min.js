define(['uiComponent','jquery','Magento_AdobeIms/js/action/authorization'],function(Component,$,login){'use strict';return Component.extend({defaults:{profileUrl:'adobe_ims/user/profile',logoutUrl:'adobe_ims/user/logout',defaultProfileImage:'https://a5.behance.net/27000444e0c8b62c56deff3fc491e1a92d07f0cb/img/profile/no-image-276.png',user:{isAuthorized:false,name:'',email:'',image:''},loginConfig:{url:'https://ims-na1.adobelogin.com/ims/authorize',callbackParsingParams:{regexpPattern:/auth\[code=(success|error);message=(.+)\]/,codeIndex:1,messageIndex:2,nameIndex:3,successCode:'success',errorCode:'error'},popupWindowParams:{width:500,height:600,top:100,left:300},popupWindowTimeout:60000}},initObservable:function(){this._super().observe(['user']);return this;},login:function(){return new window.Promise(function(resolve,reject){if(this.user().isAuthorized){return resolve();}
login(this.loginConfig).then(function(response){this.loadUserProfile();resolve(response);}.bind(this)).catch(function(error){reject(error);});}.bind(this));},loadUserProfile:function(){$.ajax({type:'POST',url:this.profileUrl,showLoader:true,data:{'form_key':window.FORM_KEY},dataType:'json',context:this,success:function(response){this.user({isAuthorized:true,name:response.result.name,email:response.result.email,image:response.result.image});},error:function(response){return response.message;}});},logout:function(){$.ajax({type:'POST',url:this.logoutUrl,data:{'form_key':window.FORM_KEY},dataType:'json',context:this,showLoader:true,success:function(){this.user({isAuthorized:false,name:'',email:'',image:this.defaultProfileImage});}.bind(this),error:function(response){return response.message;}});}});});