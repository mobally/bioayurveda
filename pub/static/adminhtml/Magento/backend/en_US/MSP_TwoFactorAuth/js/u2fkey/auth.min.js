'use strict';define(['jquery','ko','uiComponent','MSP_TwoFactorAuth/js/error','MSP_TwoFactorAuth/js/registry','MSP_TwoFactorAuth/js/u2fkey/api'],function($,ko,Component,error,registry){return Component.extend({currentStep:ko.observable('register'),trustThisDevice:registry.trustThisDevice,defaults:{template:'MSP_TwoFactorAuth/u2fkey/auth'},postUrl:'',successUrl:'',touchImageUrl:'',authenticateData:{},onAfterRender:function(){this.waitForTouch();},getTouchImageUrl:function(){return this.touchImageUrl;},getPostUrl:function(){return this.postUrl;},getSuccessUrl:function(){return this.successUrl;},waitForTouch:function(){var requestData=this.authenticateData,me=this;u2f.sign(requestData,function(signResponse){$.post(me.getPostUrl(),{'request':requestData,'response':signResponse,'tfa_trust_device':me.trustThisDevice()?1:0}).done(function(res){if(res.success){me.currentStep('login');self.location.href=me.getSuccessUrl();}else{me.waitForTouch();}}).fail(function(){error.display('Invalid device');});},120);}});});