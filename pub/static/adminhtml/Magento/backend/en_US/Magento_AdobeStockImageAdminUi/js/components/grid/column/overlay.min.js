define(['Magento_Ui/js/grid/columns/overlay','jquery'],function(overlay,$){'use strict';return overlay.extend({defaults:{provider:'name = adobe_stock_images_listing.adobe_stock_images_listing_data_source, ns = adobe_stock_images_listing',loginProvider:'name = adobe-login, ns = adobe-login',getImagesUrl:'adobe_stock/license/getlist',licensed:{},modules:{login:'${ $.loginProvider }',masonry:'${ $.parentName }'},listens:{'${ $.provider }:data.items':'updateLicensed','${ $.loginProvider }:user':'updateLicensed'}},initObservable:function(){this._super().observe(['licensed']);return this;},updateLicensed:function(){if(!this.login().user().isAuthorized){this.licensed({});return;}
$.ajax({type:'GET',url:this.getImagesUrl+'?ids='+this.getIds().join(','),data:{'form_key':window.FORM_KEY},dataType:'json',context:this,success:function(response){this.licensed(response.result);},error:function(response){return response.message;}});},getIds:function(){var ids=[];this.masonry().rows().forEach(function(record){ids.push(record.id);});return ids;},getStyles:function(record){var height=record.styles().height.replace('px','')-50;return{top:height+'px'};},isVisible:function(row){return this.licensed()[row.id];},getLabel:function(row){return this.licensed()[row.id]?'Licensed':'';}});});